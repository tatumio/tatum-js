name: Release PR

on:
  pull_request:
    branches:
      - master

jobs:
  checks:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout current
        uses: actions/checkout@v3
      - name: Get state current
        run: |
          hash=$(sha1sum CHANGELOG.md | cut -f1 -d' ')
          version=$(jq -r '.version' package.json)
          echo "pr_pkg_version=$version" >> $GITHUB_ENV 
          echo "pr_changelog_hash=$hash" >> $GITHUB_ENV
      - name: Checkout master
        uses: actions/checkout@v3
        with:
          ref: master
      - name: Get state master
        run: |
          hash=$(sha1sum CHANGELOG.md | cut -f1 -d' ')
          version=$(jq -r '.version' package.json)
          echo "master_pkg_version=$version" >> $GITHUB_ENV
          echo "master_changelog_hash=$hash" >> $GITHUB_ENV
      - name: Ensure changelog updated
        run: |
          [ "${{ env.pr_changelog_hash }}" = "${{ env.master_changelog_hash }}" ] && echo "Error: no changes in changelog detected for the release" && exit 1 || exit 0  
      - name: Ensure package version updated
        run: |
           [ "${{ env.pr_pkg_version }}" = "${{ env.master_pkg_version }}" ] && echo "Error: package version not updated" && exit 1 || exit 0
          